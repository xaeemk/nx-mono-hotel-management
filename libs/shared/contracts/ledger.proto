syntax = "proto3";

package ledger;

service LedgerService {
  rpc CreateEntry(CreateEntryRequest) returns (CreateEntryResponse);
  rpc GetEntry(GetEntryRequest) returns (GetEntryResponse);
  rpc GetBalance(GetBalanceRequest) returns (GetBalanceResponse);
  rpc GetTransactionHistory(GetTransactionHistoryRequest) returns (GetTransactionHistoryResponse);
  rpc CreateTransactionBatch(CreateTransactionBatchRequest) returns (CreateTransactionBatchResponse);
}

message CreateEntryRequest {
  string account_id = 1;
  TransactionType type = 2;
  double amount = 3;
  string currency = 4;
  string reference_id = 5;
  string reference_type = 6;
  string description = 7;
  map<string, string> metadata = 8;
}

message CreateEntryResponse {
  string entry_id = 1;
  int64 sequence_number = 2;
  string error_message = 3;
}

message GetEntryRequest {
  string entry_id = 1;
}

message GetEntryResponse {
  string entry_id = 1;
  string account_id = 2;
  TransactionType type = 3;
  double amount = 4;
  string currency = 5;
  string reference_id = 6;
  string reference_type = 7;
  string description = 8;
  int64 sequence_number = 9;
  int64 created_at = 10;
  map<string, string> metadata = 11;
}

message GetBalanceRequest {
  string account_id = 1;
  string currency = 2;
}

message GetBalanceResponse {
  string account_id = 1;
  double balance = 2;
  string currency = 3;
  int64 last_updated = 4;
}

message GetTransactionHistoryRequest {
  string account_id = 1;
  string currency = 2;
  int64 from_date = 3;
  int64 to_date = 4;
  int32 page = 5;
  int32 limit = 6;
}

message GetTransactionHistoryResponse {
  repeated GetEntryResponse entries = 1;
  int32 total = 2;
  int32 page = 3;
  int32 limit = 4;
}

message CreateTransactionBatchRequest {
  repeated CreateEntryRequest entries = 1;
  string batch_id = 2;
  string description = 3;
}

message CreateTransactionBatchResponse {
  string batch_id = 1;
  repeated string entry_ids = 2;
  string error_message = 3;
}

enum TransactionType {
  CREDIT = 0;
  DEBIT = 1;
  HOLD = 2;
  RELEASE = 3;
  REFUND = 4;
}
